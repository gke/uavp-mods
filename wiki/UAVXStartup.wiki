#summary Brief procedures on how to use UAVX for the first time.
#labels Featured,UAVX,GPS,UAVP,UAVPSet,gke,jesolins

== Introduction ==

UAVX was released for Beta testing on the 15 August 2009 Australian EST. The normal caveats apply in that use of UAVX is entirely at your own risk - see the GNU Licence. 

This is intended to be a brief introduction to the steps you may wish to take when first using UAVX. Internally UAVX is completely different to UAVP flight software. UAVX also combines test and flight software. Despite the internal differences a significant amount of effort has made to render the transition from UAVP to UAVX as painless as possible by preserving the validity of most parameter values and a familiar user interface. UAVPSet (V3.0 onwards also in this repository) has been extended to include the new features supported by UAVX.

You should NOT use GPS initially regardless of how tempting it may be to do so. UAVX only requires GPS for navigation functions and may be flown without GPS if desired.

== Assumptions ==

It is assumed you are:
  * Familiar with the use of UAVPSet to setup parameters for UAVP, UAVX's predecessor.
  * You have flown your quadrocopter/tricopter using UAVP flight software with some success.
  * You have read the UAVP manual.
  * You have installed the requisite 18F2620 PIC with associated bootloader.

== Compass Orientation ==

The software expects the compass orientation to be the same as in the manual. A correction is made by the software such that a heading of zero is obtained when the forward arm points True North. The Compass may be mounted elsewhere on the aircraft as it is the orientation that is important. The orientation was not important for non-GPS versions which used changes in direction not the absolute direction. Be aware that the North arrow on the Sparkfun boards may be incorrect!

== Stage 1: without GPS =

Most of this will be familiar to you as the procedure is nearly identical to that you will have used with UAVP. If you have a GPS DISCONNECT it.

Using UAVPSet V3.0 or later:
  * Load the flight software into your quadrocopter (there are many fewer HEX files to choose from and the one you need should be self evident).
  * Select UAVX in the pulldown. 
  * Initialise your flight parameters from a saved UAVP V3.15 file or using the Tools->Testsoftware->D command in UAVPSet. 
  * Select the Tx/Rx, Gyro and ESCs you are using from the appropriate pulldowns and write the config to parameter set #1. Be aware that the Gear switch is no longer used to switch between paramter set 1 & 2. This is done using stick programming (see the  gpsNavigation page ) once UAVX is successfully talking to your Tx/Rx. 
  * Just as for UAVP use Tools->Testsoftware to ensure your Rx signals are being received correctly. Verify this in the Rx Graphic which now displays in % units.
  * Save your parameters to a file. UAVX will accept V3.15 parameter files but files written by UAVX are not compatible with V3.15.
  * Initialise the accelerometer neutrals as for UAVP.
  * Set up parameter set 2. You will see that many of the parameters are not displayed on the Parameter Set 2 page as these are now common to both parameter sets.
  * While you steady your nerves go into the Tools menu and check out some of the many tests available because at about this point you will realise you have not calibrated your compass, checked your baro etc.! The now inbuilt test software has some sanity checks on voltages etc and may detect problems with sensors. In particular look at the Setup display which now has an extended summary of what UAVX "thinks" you have connected in the way of sensors etc. and whether they may be working or not.
  * Arm the quadrocopter and observe that the Red LED will blink several times at about one second intervals as the Gyros are initialised - this is the first difference from UAVP. The quadrocopter MUST NOT be moved while the Red LED is blinking otherwise you may have a large drift offset! The quadrocopter does not need to be level - just stationary. The Yellow LED should be on signifying the Accelerometers are online.
  * Ensure that the response of the quadrocopter is acceptable using the normal pre-flight checks. You will see that UAVPSet no longer communicates with UAVX once the quadrocopter is armed. If you need to modify parameters you will need to disarm.
  * Fly (at your own risk as always) and tune the various flight parameters as required.
  
== Stage 2: with GPS ==

This is new territory and you will need to do some homework for your location particularly the Magnetic Variation. Read the GPS Navigation page carefully.

*WARNING* - If you are using a 6 channel Rx then you do not have control over the GPS gain (see below) which will be maximum - do not proceed if you are unsure. You may still choose to fly with GPS disconnected.

Using the UAVX capable version of UAVPSet:
  * Connect your GPS.
  * Set the GPS related parameters (notes below to follow).
  * Turn the Pot/Knob connected to Channel 7 to minimum (this will disable GPS support).  
  * Select off/minimum using your Gear switch on Channel 5 (this turns RTH off). If you fail to do this a beeper alarm will sound.
  * Disable RTH altitude hold (see stick programming). This means that the normal hover mechanism is used whereby the quadrocopter will assume you are hovering after 3 seconds and use the baro and accelerometer to attempt to maintain altitude.
  * The quadrocopter can return home maintaining its current heading, pitching and/or rolling as required to move towards the Origin, or it can turn towards the Origin using pitch control only. This may also be set with Stick Programming.
  * Arm the quadrocopter and after the initial blinking Red LED as the Gyros are initialised you should see the Blue LED blinking at the update rate of your GPS. At this point the Red LED will stay lit until UAVX is happy with the GPS accuracy. This may take anything up to 5 minutes particularly on the first flight in a new location. Once the Red LED goes out a satisfactory "Origin" location has been recorded. Currently the flight software does not prevent you from taking off before the Red LED goes out but be aware the Origin value may be somewhere (anywhere) along your flight path. Be patient and wait. 
  * Takeoff and fly to a safe height and away from you 30M/100'. Check to see that you have a good hover. This initial hover is *important* as it and subsequent hovers adaptively establish the hover throttle setting used by the RTH altitude hold function. You can read what hover throttle has been used after a flight by reading the paramters. Other statistics are tracked and may be accessed using Tools->TestSoftware->X. Please note that the GPS software is not active until 30 seconds after takeoff. 
  * Engage RTH using the Gear switch. You should see no change in the behaviour of the quadrocopter. It is important that you HAVE disabled the RTH altitude hold (see above) otherwise you will have no throttle control.
  * Slowly increase the setting of the Channel 7 Pot and you should see the quadrocopter start to tilt towards the Origin position (where the GPS location was acquired after arming). You should still have control of pitch, roll, yaw and throttle and can overcome the corrections being applied by the GPS. If Channel 7 is below around 20% GPS assistance is disabled. 
  * Try switching off RTH and you should come to a halt at the current position. The GPS at this point is attempting to maintain the current position but again can be overcome using pitch and roll corrections.  There will be a temptation to "help" the GPS using pitch and roll but be aware that if you move either the pitch and roll sticks by more than about 5% then the desired location will be updated to a new position in the direction of what you perceive to be a drift which is not what you want! You may change Yaw without triggering a position update - useful for pointing cameras.
  * Keep playing until you are familiar with what is happening.

== Stage 3: RTH with Altitude Hold ==

Up to this point moving the control sticks will overcome any corrections the GPS may be exerting. This stage is a lot different as you are handing over throttle control completely to the navigation software.

The steps are:
  * Set the Barometer as your Altitude source using UAVPSet.
  * Check the navigation parameters are as recommended in the defaults.
  * Select RTH altitude hold using stick programming.
  * Use the GPS gain setting (Channel 7) you found you were happy with in Stage 2.
  * As in Stage 2 fly to a safe altitude and distance.
  * Engage RTH. At this point you have NO THROTTLE CONTROL AT ALL as this is being used by the RTH altitude hold software. Leave the throttle where it is or increase it by about 10%. Do not close throttle or when you disengage RTH, the quadrocopter will fall like a brick.  If the RTH altitude you have set is much higher than when you engaged RTH then the quadrocopter will climb quite rapidly and your natural instinct will be to close the throttle - don't do it. If all is well you should see the quadrocopter climb/descend to the RTH altitude you have selected and start heading back to the Origin. If you are unhappy disengage RTH.
  * As in Stage 2 keep playing - safely. 

== Stage 4: RTH with Altitude Hold and Auto Descend ==

THIS IS VERY EXPERIMENTAL so take care and start with an RTH altitude setting which is reasonably high (say 30M) to allow you time to respond.

If you enable RTH Descend in UAVPSet then thirty seconds after you have arrived within the  selected radius of the Origin position with RTH still engaged the quadrocopter should start to descend at around 1 Meter/Sec slowing in the last 15M.  Disengaging RTH will cause the quadrocopter to revert to GPS assisted position hold but you must control the altitude manually. This is the reason that moving the throttle up 10% after engaging RTH may be a good strategy to have as it will arrest the fall if you disengage and hopefully give you enough time to re-establish hover.

The auto descend feature is the logical extension of using RTH primarily as failsafe support. We suggest RTH altitude enabled (the default) be adopted with you Rx failsafes set appropriately to advantage of this. 

== Other Stuff == 

There are many other things we can try/abandon including:

  * Ground proximity using a simple switch to kill throttle (its in the software) or an ultrasonic rangefinder. Not useful for tree encounters or landing upside down.
  * Altitude and distance from Origin containment i.e. not too high and not too far.
  * etc....

== Suggested Navigation Parameters ==

Use the UAVPSet Tools->Testsoftware->D defaults for now.

An option is to use Parameter set #1 for still conditions and #2 for windy conditions. We expect the more successful combinations of navigation related parameters to evolve over time. More of the internal software controls are likely to be accessible through UAVPSet as we gain experience. 
  